

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>merge.py &mdash; The Community Firn Model 1.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="physics.py" href="physics.html" />
    <link rel="prev" title="melt.py" href="melt.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Community Firn Model
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../running/index.html">Running the CFM</a></li>
</ul>
<p class="caption"><span class="caption-text">Files:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Files included with the CFM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AirConfig.html">airconfig.json</a></li>
<li class="toctree-l2"><a class="reference internal" href="constants.html">constants.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="diffusion.html">diffusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html">example.json</a></li>
<li class="toctree-l2"><a class="reference internal" href="fcts_snowpackflow.html">fcts_snowpackflow.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="firn_air.html">firn_air.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="firn_density_nospin.html">firn_density_nospin</a></li>
<li class="toctree-l2"><a class="reference internal" href="firn_density_spin.html">firn_density_spin</a></li>
<li class="toctree-l2"><a class="reference internal" href="hl_analytic.html">hl_analytic</a></li>
<li class="toctree-l2"><a class="reference internal" href="isotopeDiffusion.html">isotopeDiffusion.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="main.html">main</a></li>
<li class="toctree-l2"><a class="reference internal" href="melt.html">melt.py</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">merge.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="physics.html">physics.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotter.html">plotter.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="prefflow_snowpack.html">prefflow_snowpack.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="re_snowpack.html">re_snowpack.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="reader.html">reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="regrid.html">regrid.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="solver.html">solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="sublim.html">sublim.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="writer.html">writer</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Extras:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extras/index.html">Extra information about running the CFM</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Community Firn Model</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Files included with the CFM</a> &raquo;</li>
        
      <li>merge.py</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/files/merge.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-merge">
<span id="merge-py"></span><h1>merge.py<a class="headerlink" href="#module-merge" title="Permalink to this headline">¶</a></h1>
<p>Script that contains 3 functions. These are to be used if we want to proceed to merging of thin layers of the firn column.
I suggest we specify in json input if merge is true/false and the thickness threshold (‘merge_min’):
“merging”: true,
“merge_min”: 5e-3
mergesurf(): for layer[0] and layer[1], to be used in time_evolve() of firn_density_nospin
mergenotsurf(): for layers[2:], to be used in time_evolve() of firn_density_nospin
mergeall(): for all layers, to be used at the end of firn_density_spin
CAUTION:
- not used for all variables (e.g. du_dx)
- nothing is done considering gas neither for isotopes
&#64;author: verjans</p>
<dl class="py function">
<dt id="merge.mergeall">
<code class="sig-prename descclassname">merge.</code><code class="sig-name descname">mergeall</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">thickmin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#merge.mergeall" title="Permalink to this definition">¶</a></dt>
<dd><p>We spot the layers that are under a certain thickness threshold and we merge these with the underlying layer
This has to be launched at the end of the spinup, we use other functions in firn_density_nospin.
Here we change self.compboxes as we modify the number of layers above 80m depth.</p>
</dd></dl>

<dl class="py function">
<dt id="merge.mergenotsurf">
<code class="sig-prename descclassname">merge.</code><code class="sig-name descname">mergenotsurf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">thickmin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#merge.mergenotsurf" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is to call during time_evolve function of firn_density_nospin.
We merge all the layers below a thickness threshold except the layers of indices 0 and 1.
This allows layers that became too thin due to compaction to be merged with the layer below.
Minimum thickness threshold must be specified as thickmin
We don’t do this for surface layer because that would lead to any newly accumulated layer to be merged if RCM forcing is on a short time scale. The surface layer has its own function mergesurf().</p>
</dd></dl>

<dl class="py function">
<dt id="merge.mergesurf">
<code class="sig-prename descclassname">merge.</code><code class="sig-name descname">mergesurf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">self</span></em>, <em class="sig-param"><span class="n">thickmin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#merge.mergesurf" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is to call during time_evolve function of firn_density_nospin.
We merge the surface layer[0] with the layer[1] below as long as layer[1] remains under a certain thickness threshold.
By applying condition on layer[1] instead of layer[0], we avoid merging all newly accumulated layers in the case we use a RCM forcing on a short time scale.
Thickness threshold must be specified and consistent with the one of mergenotsurf().</p>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="physics.html" class="btn btn-neutral float-right" title="physics.py" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="melt.html" class="btn btn-neutral float-left" title="melt.py" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Max Stevens

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>